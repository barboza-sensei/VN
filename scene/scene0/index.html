<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Escena 0 — La calle sin principio</title>
  <link rel="stylesheet" href="../../style.css" />
  <style>
    /* Estilos locales para la atmósfera de esta escena */
    body {
        background-image: url('../../assets/bg/calle_oscura_sin_luces.jpg'); 
        background-color: #0d0d0d;
    }
    
    /* ******************************************************* */
    /* ESTILOS DE POSICIONAMIENTO DE LA CAJA */
    /* ******************************************************* */
    #main-dialogue-box {
        position: absolute; 
        bottom: 5vh; 
        left: 50%;
        transform: translateX(-50%);
        width: 90%;
        max-width: 800px;
        padding: 1.5em;
    }
    
    /* ******************************************************* */
    /* ESTILOS DE BOTONES DE ELECCIÓN */
    /* ******************************************************* */
    #choices {
        display: flex;
        flex-direction: column;
        gap: 0; 
        margin-top: 15px; 
    }

    .choice-btn {
        background: rgba(0, 0, 0, 0.4); 
        border: none;
        border-radius: 0; 
        color: #f0f0f0;
        padding: 12px 15px;
        font-size: 1.1em;
        text-align: left; 
        transition: all 0.2s ease;
        cursor: pointer;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1); 
    }

    .choice-btn:hover, .choice-btn:focus {
        background: rgba(40, 40, 40, 0.6); 
        box-shadow: 0 0 0 1px #aaffff; 
        color: #aaffff; 
        outline: none; 
    }

    #choices .choice-btn:last-child {
        border-bottom: none; 
    }
    /* ******************************************************* */

    /* CORRECCIÓN: ESTILOS PARA OCULTAR FLECHA ::AFTER */
    #nextBtn::after {
        content: none !important; /* Forzamos la eliminación del contenido ::after */
        visibility: hidden;
    }

    /* Aseguramos que la flecha del texto se vea */
    #nextBtn {
        text-indent: 0; /* Aseguramos que el texto sea visible */
        overflow: visible; 
    }
  </style>
</head>

<body>
  <div class="dialogue-box" id="main-dialogue-box">
    <p id="text"></p>
    <div id="choices"></div>
    <button id="nextBtn" title="Continuar">➤</button> 
  </div>

  <script>
    const scene0 = {
      id: 0,
      title: "La calle sin principio",
      text: [
        { type: 'narrative', content: "Despertás de pie, en el centro exacto de la calle. No hay rastro de si estabas caminando, ni memoria de haber llegado aquí."},
        { type: 'narrative', content: "La calle es una línea perfecta, fríamente recta, que se extiende hasta desvanecerse en la oscuridad."},
        { type: 'narrative', content: "Los faroles son meros bocetos de metal, estructuras desnudas y sin luz."},
        { type: 'narrative', content: "Una brisa tenue, predecible, te empuja con una insistencia sutil hacia adelante."},
        { type: 'narrative', content: "A tu izquierda, la esquina. Una vidriera opaca, rota por una grieta que parece un error en el patrón del mundo."},
        { type: 'narrative', content: "A tu derecha, un callejón estrecho y oscuro. Su hedor a lluvia antigua es lo único que ancla este lugar a lo orgánico."},
        { type: 'voice', speaker: 'Murmullo', content: "La elección define el primer movimiento en esta realidad."} 
      ],
      choices: [
        { text: "Doblar a la izquierda (La Grieta en el Patrón)", nextScene: "../scene1/index.html" },
        { text: "Doblar a la derecha (El Callejón Orgánico)", nextScene: "../scene1/index.html" }
      ]
    };

    const textEl = document.getElementById("text");
    const choicesEl = document.getElementById("choices");
    const nextBtn = document.getElementById("nextBtn");

    let i = 0;

    function showLine() {
      if (i >= scene0.text.length) {
          return;
      }
      
      const lineData = scene0.text[i];
      textEl.className = 'fade-text';

      if (lineData.type === 'voice') {
          const voiceClass = 'disparia-voice';
          textEl.innerHTML = `<span class="${voiceClass}">${lineData.speaker}: ${lineData.content}</span>`;
      } else {
          textEl.textContent = lineData.content;
      }

      nextBtn.style.display = i < scene0.text.length - 1 ? "inline-flex" : "none";

      if (i === scene0.text.length - 1) {
        showChoices();
      }
      
      void textEl.offsetWidth; 
    }

    nextBtn.addEventListener("click", () => {
      if (i < scene0.text.length - 1) {
        i++;
        showLine();
      }
    });

    function showChoices() {
      choicesEl.innerHTML = "";
      scene0.choices.forEach(c => {
        const btn = document.createElement("button");
        btn.textContent = c.text;
        btn.className = 'choice-btn'; 
        btn.onclick = () => goTo(c.nextScene);
        choicesEl.appendChild(btn);
      });
    }

    function goTo(relativePath) {
      const base = window.location.href.substring(0, window.location.href.lastIndexOf('/') + 1);
      const resolved = new URL(relativePath, base).href;
      window.location.href = resolved;
    }

    window.onload = showLine;
  </script>
</body>
</html>
