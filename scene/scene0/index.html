<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Escena 0 — La calle sin principio</title>
  <link rel="stylesheet" href="../../style.css" />
  <style>
    /* Estilos locales para la atmósfera de esta escena */
    body {
        /* IMAGEN INICIAL (Imagen 1) */
        background-image: url('assets/bg/calle_oscura_sin_luces_inicio.png'); 
        background-color: #0d0d0d;
        background-size: cover; 
        background-position: center;
        transition: background-image 1s ease-in-out; 
    }
    
    /* [Resto de estilos de posicionamiento y botones...] */

    #main-dialogue-box {
        position: absolute; 
        bottom: 5vh; 
        left: 50%;
        transform: translateX(-50%);
        width: 90%;
        max-width: 800px;
        padding: 1.5em;
    }
    
    #choices {
        display: flex;
        flex-direction: column;
        gap: 0; 
        margin-top: 15px; 
    }

    .choice-btn {
        background: rgba(0, 0, 0, 0.4); 
        border: none;
        border-radius: 0; 
        color: #f0f0f0;
        padding: 12px 15px;
        font-size: 1.1em;
        text-align: left; 
        transition: all 0.2s ease;
        cursor: pointer;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1); 
    }

    .choice-btn:hover, .choice-btn:focus {
        background: rgba(40, 40, 40, 0.6); 
        box-shadow: 0 0 0 1px #aaffff; 
        color: #aaffff; 
        outline: none; 
    }

    #choices .choice-btn:last-child {
        border-bottom: none; 
    }

    #nextBtn::after {
        content: none !important; 
        visibility: hidden;
    }

    #nextBtn {
        text-indent: 0; 
        overflow: visible; 
    }
  </style>
</head>

<body>
  <div class="dialogue-box" id="main-dialogue-box">
    <p id="text"></p>
    <div id="choices"></div>
    <button id="nextBtn" title="Continuar">➤</button> 
  </div>

  <script>
    const scene0 = {
      id: 0,
      title: "La calle sin principio",
      text: [
        { type: 'narrative', content: "Despertás de pie, en el centro exacto de la calle. No hay rastro de si estabas caminando, ni memoria de haber llegado aquí."}, // i=0
        { type: 'narrative', content: "La calle es una línea perfecta, fríamente recta, que se extiende hasta desvanecerse en la oscuridad."}, // i=1
        { type: 'narrative', content: "Los faroles son meros bocetos de metal, estructuras desnudas y sin luz."}, // i=2
        { type: 'narrative', content: "Una brisa tenue, predecible, te empuja con una insistencia sutil hacia adelante."}, // i=3
        { type: 'narrative', content: "A tu izquierda, la esquina. Una vidriera opaca, rota por una grieta que parece un error en el patrón del mundo."}, // i=4 (Cambia a Imagen 2)
        { type: 'narrative', content: "A tu derecha, un callejón estrecho y oscuro. Su hedor a lluvia antigua es lo único que ancla este lugar a lo orgánico."}, // i=5 (Mantiene Imagen 2, ya que Imagen 3 no está)
        { type: 'voice', speaker: 'Murmullo', content: "La elección define el primer movimiento en esta realidad."} // i=6 (Mantiene Imagen 2)
      ],
      choices: [
        { text: "Doblar a la izquierda (La Grieta en el Patrón)", nextScene: "../scene1/index.html" },
        { text: "Doblar a la derecha (El Callejón Orgánico)", nextScene: "../scene1/index.html" }
      ]
    };

    const textEl = document.getElementById("text");
    const choicesEl = document.getElementById("choices");
    const nextBtn = document.getElementById("nextBtn");

    let i = 0;
    
    // Rutas de imagen
    const IMG_GENERAL = 'assets/bg/calle_oscura_sin_luces_inicio.png';
    const IMG_CALLEJON = 'assets/bg/calle_oscura_sin_luces_cerca_callejon.png'; 
    // const IMG_CALLEJON = 'assets/bg/calle_oscura_sin_luces_cerca_callejon.png'; // Usaremos IMG_GENERAL como fallback

    function changeBackground(imageUrl) {
        document.body.style.backgroundImage = `url('${imageUrl}')`;
    }

    function showLine() {
      if (i >= scene0.text.length) {
          return;
      }
      
      // LÓGICA DE CAMBIO DE FONDO EJECUTADA
      if (i === 4) { 
          // Al llegar a la descripción de la callejon, mostramos la vista más cercana/de detalle (Imagen 2)
          changeBackground(IMG_CALLEJON);
      } else if (i === 5) {
          // Si el jugador tuviera la Imagen 3, la cambiaríamos aquí. Por ahora, usamos la Imagen 2 como fallback, ya que es la vista más cercana.
          // changeBackground(IMG_CALLEJON); 
      }
      // Nota: Si solo tiene dos fondos, es más eficiente usar la imagen 2 para las descripciones y la elección.

      const lineData = scene0.text[i];
      textEl.className = 'fade-text';

      if (lineData.type === 'voice') {
          const voiceClass = 'disparia-voice';
          textEl.innerHTML = `<span class="${voiceClass}">${lineData.speaker}: ${lineData.content}</span>`;
      } else {
          textEl.textContent = lineData.content;
      }

      nextBtn.style.display = i < scene0.text.length - 1 ? "inline-flex" : "none";

      if (i === scene0.text.length - 1) {
        showChoices();
      }
      
      void textEl.offsetWidth; 
    }

    nextBtn.addEventListener("click", () => {
      if (i < scene0.text.length - 1) {
        i++;
        showLine();
      }
    });

    function showChoices() {
      choicesEl.innerHTML = "";
      scene0.choices.forEach(c => {
        const btn = document.createElement("button");
        btn.textContent = c.text;
        btn.className = 'choice-btn'; 
        btn.onclick = () => goTo(c.nextScene);
        choicesEl.appendChild(btn);
      });
    }

    function goTo(relativePath) {
      const base = window.location.href.substring(0, window.location.href.lastIndexOf('/') + 1);
      const resolved = new URL(relativePath, base).href;
      window.location.href = resolved;
    }

    window.onload = showLine;
  </script>
</body>
</html>
